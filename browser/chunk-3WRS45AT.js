import{d as q}from"./chunk-4CNLZDSJ.js";import{a as P}from"./chunk-UIZX3M5J.js";import{b as L,c as m,d as Y,e as U,h as $,i as G,j as H,k as J,l as K,m as Q,n as W,o as X,p as Z,q as ee,r as te,s as ne,t as ie}from"./chunk-KIDSA5FJ.js";import{d as w}from"./chunk-B76GRXA5.js";import{$a as c,Ab as C,Bb as N,Cb as V,Ia as g,Jb as R,Kb as y,Mb as E,Na as b,Q as _,R as v,Ra as f,Vb as B,W as I,ab as e,bb as n,cb as x,gc as z,hc as M,ic as A,kb as h,lc as j,mb as p,mc as S,ob as u,wb as T,xb as F,za as d,zb as r}from"./chunk-WY347VJD.js";import{a as k,b as D}from"./chunk-7CGTOI24.js";function se(o,t){o&1&&(e(0,"small"),r(1," M\xEAs inv\xE1lido (1 a 12) "),n())}function me(o,t){o&1&&(e(0,"small"),r(1," Ano inv\xE1lido "),n())}function pe(o,t){o&1&&(e(0,"small",33),r(1," O cart\xE3o j\xE1 est\xE1 vencido "),n())}var O=class o{constructor(t,i,a){this.fb=t;this.service=i;this.toastr=a;this.form=this.fb.group({bank_name:["",m.required],brand:["",m.required],last_four_digits:["",[m.required,m.pattern(/^\d{4}$/)]],limit:["",m.required],closing_day:["",m.required],due_day:["",m.required],expiration_month:["",[m.required,m.min(1),m.max(12)]],expiration_year:["",[m.required,m.min(this.currentYear())]]},{validators:this.expirationValidator})}saved=new I;cancel=new I;card;form;ngOnInit(){if(this.card){let t=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(this.card.limit);this.form.patchValue(D(k({},this.card),{limit:t}))}}currentYear(){return new Date().getFullYear()%100}expirationValidator(t){let i=t.get("expiration_month")?.value,a=t.get("expiration_year")?.value;if(!i||!a)return null;let l=new Date,s=new Date(2e3+a,i,0);return l>s?{expired:!0}:null}formatLimit(){let t=this.form.get("limit");if(!t)return;let i=t.value;if(!i)return;let a=i.replace(/\D/g,"");if(!a){t.setValue("",{emitEvent:!1});return}let l=Number(a)/100;t.setValue(new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(l),{emitEvent:!1})}submit(){if(this.form.invalid){this.form.markAllAsTouched(),this.toastr.warning("Preencha todos os campos corretamente");return}let t=D(k({},this.form.value),{limit:Number(this.form.value.limit.replace(/\./g,"").replace(",","."))});(this.card?this.service.updateCard(this.card.id,t):this.service.createCard(t)).subscribe({next:()=>{this.toastr.success(this.card?"Cart\xE3o atualizado com sucesso":"Cart\xE3o cadastrado com sucesso"),this.saved.emit(),this.form.reset()},error:()=>{this.toastr.error("Erro ao salvar cart\xE3o")}})}close(){this.cancel.emit()}static \u0275fac=function(i){return new(i||o)(g(ne),g(P),g(w))};static \u0275cmp=b({type:o,selectors:[["app-card-form"]],inputs:{card:"card"},outputs:{saved:"saved",cancel:"cancel"},decls:63,vars:4,consts:[[3,"ngSubmit","formGroup"],["formControlName","bank_name","required",""],["value","","disabled","","selected",""],["value","Banco do Brasil"],["value","Nubank"],["value","Ita\xFA"],["value","Bradesco"],["value","Santander"],["value","Caixa"],["value","Inter"],["value","Next"],["formControlName","brand","required",""],["value","Visa"],["value","MasterCard"],["value","Elo"],["value","American Express"],["value","Hipercard"],["value","Maestro"],["value","Diners Club"],["value","Discover"],["value","UnionPay"],["placeholder","\xDAltimos 4 d\xEDgitos","maxlength","4","formControlName","last_four_digits"],["type","text","placeholder","Limite (R$)","formControlName","limit","inputmode","decimal",3,"blur"],[1,"row"],["type","number","placeholder","M\xEAs validade (MM)","formControlName","expiration_month"],[4,"ngIf"],["type","number","placeholder","Ano validade (YY)","formControlName","expiration_year"],["type","number","placeholder","Fechamento da fatura (dia)","formControlName","closing_day","min","1","max","31"],["type","number","placeholder","Vencimento da fatura (dia)","formControlName","due_day","min","1","max","31"],["class","error",4,"ngIf"],[1,"actions"],["type","submit",1,"primary"],["type","button",1,"secondary",3,"click"],[1,"error"]],template:function(i,a){if(i&1&&(e(0,"form",0),p("ngSubmit",function(){return a.submit()}),e(1,"h3"),r(2,"Cadastre um novo cart\xE3o"),n(),e(3,"select",1)(4,"option",2),r(5,"Selecione o banco"),n(),e(6,"option",3),r(7,"Banco do Brasil"),n(),e(8,"option",4),r(9,"Nubank"),n(),e(10,"option",5),r(11,"Ita\xFA"),n(),e(12,"option",6),r(13,"Bradesco"),n(),e(14,"option",7),r(15,"Santander"),n(),e(16,"option",8),r(17,"Caixa"),n(),e(18,"option",9),r(19,"Inter"),n(),e(20,"option",10),r(21,"Next"),n()(),e(22,"select",11)(23,"option",2),r(24,"Selecione a bandeira"),n(),e(25,"option",12),r(26,"Visa"),n(),e(27,"option",13),r(28,"MasterCard"),n(),e(29,"option",14),r(30,"Elo"),n(),e(31,"option",15),r(32,"American Express"),n(),e(33,"option",16),r(34,"Hipercard"),n(),e(35,"option",17),r(36,"Maestro"),n(),e(37,"option",18),r(38,"Diners Club"),n(),e(39,"option",19),r(40,"Discover"),n(),e(41,"option",20),r(42,"UnionPay"),n()(),x(43,"input",21),e(44,"input",22),p("blur",function(){return a.formatLimit()}),n(),e(45,"div",23)(46,"div"),x(47,"input",24),f(48,se,2,0,"small",25),n(),e(49,"div"),x(50,"input",26),f(51,me,2,0,"small",25),n()(),e(52,"div",23)(53,"div"),x(54,"input",27),n(),e(55,"div"),x(56,"input",28),n()(),f(57,pe,2,0,"small",29),e(58,"div",30)(59,"button",31),r(60,"Salvar"),n(),e(61,"button",32),p("click",function(){return a.close()}),r(62,"Cancelar"),n()()()),i&2){let l,s;c("formGroup",a.form),d(48),c("ngIf",((l=a.form.get("expiration_month"))==null?null:l.invalid)&&((l=a.form.get("expiration_month"))==null?null:l.touched)),d(3),c("ngIf",((s=a.form.get("expiration_year"))==null?null:s.invalid)&&((s=a.form.get("expiration_year"))==null?null:s.touched)),d(6),c("ngIf",a.form.errors==null?null:a.form.errors.expired)}},dependencies:[S,M,ie,$,Q,W,L,G,K,Y,U,ee,te,Z,X,J,H],styles:["form[_ngcontent-%COMP%]{background:#fff;padding:24px;border-radius:16px;width:100%;max-width:420px;margin:0 auto;display:flex;flex-direction:column;gap:16px;box-shadow:0 10px 30px #0000001f;box-sizing:border-box}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{width:100%;box-sizing:border-box;background:#f1f5f9;border:1px solid #cbd5f5;border-radius:10px;padding:12px 14px;color:#0f172a;font-size:14px}input[_ngcontent-%COMP%]::placeholder{color:#64748b}.row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:12px}button.primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#2563eb,#1d4ed8);border:none;color:#fff;padding:12px;border-radius:12px;font-weight:600;cursor:pointer;transition:transform .15s ease,box-shadow .15s ease}button.primary[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 8px 18px #2563eb59}.actions[_ngcontent-%COMP%]{display:flex;gap:12px}button.secondary[_ngcontent-%COMP%]{background:transparent;border:1px solid #cbd5f5;color:#2563eb;padding:12px;border-radius:12px;cursor:pointer}small[_ngcontent-%COMP%]{color:#dc2626;font-size:12px}.error[_ngcontent-%COMP%]{margin-top:-8px}"]})};var ue=o=>({background:o});function ge(o,t){if(o&1){let i=h();e(0,"div",10)(1,"app-card-form",11),p("saved",function(){_(i);let l=u();return v(l.closeForm())})("cancel",function(){_(i);let l=u();return l.showForm=!1,v(l.selectedCard=null)}),n()()}if(o&2){let i=u();d(),c("card",i.selectedCard)}}function fe(o,t){o&1&&(e(0,"div",12),r(1," Carregando cart\xF5es... "),n())}function xe(o,t){o&1&&(e(0,"div",13),r(1," Nenhum cart\xE3o cadastrado "),n())}function _e(o,t){o&1&&(e(0,"span",31),r(1," Expira em breve "),n())}function ve(o,t){o&1&&(e(0,"span",32),r(1," Cart\xE3o vencido "),n())}function Ce(o,t){if(o&1){let i=h();e(0,"div",16)(1,"div",17)(2,"div",18)(3,"span",19),r(4),n(),e(5,"span",20),r(6),n(),e(7,"div",21)(8,"button",22),p("click",function(){let l=_(i).$implicit,s=u(2);return v(s.editCard(l))}),e(9,"span",4),r(10,"edit"),n()(),e(11,"button",23),p("click",function(){let l=_(i).$implicit,s=u(2);return v(s.deleteCard(l))}),e(12,"span",4),r(13,"delete"),n()()()(),e(14,"div",24),r(15),n(),e(16,"div",25),r(17),f(18,_e,2,0,"span",26)(19,ve,2,0,"span",27),n()(),e(20,"div",28)(21,"div",29),x(22,"div",30),n(),e(23,"div")(24,"small"),r(25,"Limite:"),n(),e(26,"strong"),r(27),y(28,"currency"),n()(),e(29,"div")(30,"small"),r(31,"Gasto:"),n(),e(32,"strong"),r(33),y(34,"currency"),n()(),e(35,"div")(36,"small"),r(37,"Dispon\xEDvel:"),n(),e(38,"strong"),r(39),y(40,"currency"),n()()()()}if(o&2){let i=t.$implicit,a=u(2);d(),F("expired",a.isCardExpired(i)),c("ngStyle",R(34,ue,"linear-gradient(135deg,"+a.getCardColor(i.bank_name)+", #020617)")),d(3),C(i.bank_name),d(2),C(i.brand),d(2),c("disabled",!a.canEditCard(i)),d(7),N(" **** **** **** ",i.last_four_digits," "),d(2),V(" Expira ",i.expiration_month,"/",i.expiration_year," "),d(),c("ngIf",a.isCardExpiringSoon(i)),d(),c("ngIf",a.isCardExpired(i)),d(3),T("width",a.getUsagePercent(i),"%"),F("safe",a.getUsagePercent(i)<50)("warning",a.getUsagePercent(i)>=50&&a.getUsagePercent(i)<80)("danger",a.getUsagePercent(i)>=80),d(5),C(E(28,22,i.limit,"BRL","symbol")),d(6),C(E(34,26,i.total_spent,"BRL","symbol")),d(6),C(E(40,30,i.available_limit,"BRL","symbol"))}}function be(o,t){if(o&1&&(e(0,"div",14),f(1,Ce,41,36,"div",15),n()),o&2){let i=u();d(),c("ngForOf",i.cards)}}function he(o,t){if(o&1){let i=h();e(0,"div",33)(1,"div",34)(2,"h3"),r(3,"Confirmar exclus\xE3o"),n(),e(4,"p"),r(5," Realmente deseja remover o cart\xE3o "),e(6,"strong"),r(7),n(),r(8,"? "),n(),e(9,"div",35)(10,"button",36),p("click",function(){_(i);let l=u();return v(l.cancelDelete())}),r(11," Cancelar "),n(),e(12,"button",37),p("click",function(){_(i);let l=u();return v(l.confirmDeleteCard())}),r(13," Remover "),n()()()()}if(o&2){let i=u();d(7),C(i.cardToDelete==null?null:i.cardToDelete.bank_name)}}var re=class o{constructor(t,i,a,l){this.service=t;this.router=i;this.cd=a;this.toastr=l}selectedCard=null;cards=[];loading=!0;showForm=!1;confirmDelete=!1;cardToDelete=null;ngOnInit(){this.loadCards()}loadCards(){this.loading=!0,this.service.getCards().subscribe({next:t=>{this.cards=t,this.loading=!1,this.cd.detectChanges()},error:()=>{this.loading=!1,this.toastr.error("Erro ao carregar cart\xF5es")}})}openForm(){this.showForm=!0}closeForm(){this.showForm=!1,this.loadCards()}getCardColor(t){return t&&{"banco do brasil":"#facc15",nubank:"#6d28d9",ita\u00FA:"#f97316",itau:"#f97316",bradesco:"#dc2626",santander:"#b91c1c",caixa:"#2563eb",inter:"#f97316",next:"#16a34a"}[t.toLowerCase()]||"#334155"}isCardExpired(t){if(!t.expiration_month||!t.expiration_year)return!1;let i=new Date,a=2e3+Number(t.expiration_year),l=Number(t.expiration_month),s=new Date(a,l,0,23,59,59);return i>s}isCardExpiringSoon(t){if(!t.expiration_month||!t.expiration_year||this.isCardExpired(t))return!1;let i=new Date,a=2e3+Number(t.expiration_year),l=Number(t.expiration_month),s=new Date(a,l,0,23,59,59);return(s.getFullYear()-i.getFullYear())*12+(s.getMonth()-i.getMonth())<=3}editCard(t){if(this.isCardExpired(t)){this.toastr.warning("Este cart\xE3o est\xE1 vencido e n\xE3o pode ser editado");return}this.selectedCard=t,this.showForm=!0}deleteCard(t){this.cardToDelete=t,this.confirmDelete=!0}cancelDelete(){this.confirmDelete=!1,this.cardToDelete=null}confirmDeleteCard(){if(!this.cardToDelete)return;let t=this.cardToDelete.id;this.service.deleteCard(t).subscribe({next:()=>{this.toastr.success("Cart\xE3o removido com sucesso"),this.confirmDelete=!1,this.cardToDelete=null,this.loadCards()},error:()=>{this.toastr.error("Erro ao remover cart\xE3o")}})}canEditCard(t){return!this.isCardExpired(t)}getUsagePercent(t){return!t.limit||t.limit===0?0:Math.min(t.total_spent/t.limit*100,100)}static \u0275fac=function(i){return new(i||o)(g(P),g(q),g(B),g(w))};static \u0275cmp=b({type:o,selectors:[["app-cards"]],decls:13,vars:5,consts:[[1,"cards-page"],[1,"cards-header"],[1,"page-title"],[1,"primary","new-card-btn",3,"click"],[1,"material-icons"],["class","form-overlay",4,"ngIf"],["class","loading",4,"ngIf"],["class","empty",4,"ngIf"],["class","cards-grid",4,"ngIf"],["class","overlay",4,"ngIf"],[1,"form-overlay"],[3,"saved","cancel","card"],[1,"loading"],[1,"empty"],[1,"cards-grid"],["class","card-wrapper",4,"ngFor","ngForOf"],[1,"card-wrapper"],[1,"credit-card",3,"ngStyle"],[1,"card-top"],[1,"bank"],[1,"brand"],[1,"card-actions"],["title","Editar",1,"icon",3,"click","disabled"],["title","Remover",1,"icon","danger",3,"click"],[1,"card-middle"],[1,"card-bottom"],["class","badge warning",4,"ngIf"],["class","badge danger",4,"ngIf"],[1,"card-info"],[1,"usage-bar"],[1,"usage-progress"],[1,"badge","warning"],[1,"badge","danger"],[1,"overlay"],[1,"modal","confirm-modal"],[1,"actions"],[1,"outline",3,"click"],[1,"danger",3,"click"]],template:function(i,a){i&1&&(e(0,"div",0)(1,"div",1)(2,"h1",2),r(3,"Cart\xF5es"),n(),e(4,"button",3),p("click",function(){return a.openForm()}),e(5,"span",4),r(6,"add"),n(),r(7," Novo Cart\xE3o "),n()(),f(8,ge,2,1,"div",5)(9,fe,2,0,"div",6)(10,xe,2,0,"div",7)(11,be,2,1,"div",8)(12,he,14,1,"div",9),n()),i&2&&(d(8),c("ngIf",a.showForm),d(),c("ngIf",a.loading),d(),c("ngIf",!a.loading&&a.cards.length===0),d(),c("ngIf",!a.loading&&a.cards.length>0),d(),c("ngIf",a.confirmDelete))},dependencies:[S,z,M,A,O,j],styles:['@charset "UTF-8";.form-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#020617bf;display:flex;align-items:center;justify-content:center;z-index:50}.cards-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:40px;gap:16px}@media(max-width:600px){.cards-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}}.cards-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:24px;max-width:1200px;margin:0 auto}.card-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.credit-card[_ngcontent-%COMP%]{height:180px;border-radius:16px;padding:20px;color:#fff;box-shadow:0 12px 30px #0006;display:flex;flex-direction:column;justify-content:space-between}.card-top[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-weight:600}.card-middle[_ngcontent-%COMP%]{font-size:18px;letter-spacing:2px}.card-bottom[_ngcontent-%COMP%]{font-size:13px;opacity:.85}.card-info[_ngcontent-%COMP%]{background:#f8fafc;border-radius:0 0 16px 16px;margin-top:-8px;padding:14px}.card-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{white-space:nowrap;color:#0f172a;font-size:14px;word-break:break-word}.info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));margin-top:10px;gap:8px;text-align:center}.loading[_ngcontent-%COMP%], .empty[_ngcontent-%COMP%]{text-align:center;padding:40px;opacity:.6;font-size:14px}@media(max-width:480px){.card-info[_ngcontent-%COMP%]{grid-template-columns:1fr;text-align:left}.cards-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.card-info[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#475569;font-size:12px}.credit-card.overdue[_ngcontent-%COMP%]{filter:grayscale(.6) brightness(.7)}.badge[_ngcontent-%COMP%]{margin-left:8px;padding:2px 8px;font-size:11px;border-radius:999px;color:#fff;white-space:nowrap}.badge.warning[_ngcontent-%COMP%]{background:#f59e0b}.badge.danger[_ngcontent-%COMP%]{background:#dc2626}.card-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.card-actions[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{background:transparent;border:none;cursor:pointer;color:#e5e7eb;opacity:.75;display:inline-flex;align-items:center;transition:all .2s ease}.card-actions[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]:hover{opacity:1;transform:scale(1.1)}.card-actions[_ngcontent-%COMP%]   .icon.danger[_ngcontent-%COMP%]{color:#fca5a5}.card-actions[_ngcontent-%COMP%]   .icon.danger[_ngcontent-%COMP%]:hover{color:#ef4444}.credit-card.expired[_ngcontent-%COMP%]{filter:grayscale(.4) brightness(.8)}.card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.usage-bar[_ngcontent-%COMP%]{height:8px;background:#1e293b;border-radius:6px;overflow:hidden;margin-top:10px}.usage-progress[_ngcontent-%COMP%]{height:100%;transition:width .4s ease}.usage-progress.safe[_ngcontent-%COMP%]{background:#22c55e}.usage-progress.warning[_ngcontent-%COMP%]{background:#f59e0b}.usage-progress.danger[_ngcontent-%COMP%]{background:#ef4444}.overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#020617b3;-webkit-backdrop-filter:blur(6px);backdrop-filter:blur(6px);display:flex;align-items:center;justify-content:center;z-index:1000;padding:16px}.modal[_ngcontent-%COMP%]{width:100%;max-width:360px;padding:20px 18px;border-radius:14px;background:#fff;color:#0f172a}.confirm-modal[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;text-align:center}.confirm-modal[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:18px;font-weight:600;margin:0}.confirm-modal[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;opacity:.85;margin:0;line-height:1.4}.confirm-modal[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px;margin-top:12px}.confirm-modal[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:96px;height:40px;border-radius:10px;font-size:13px}button.outline[_ngcontent-%COMP%]{background:transparent;border:1px solid #cbd5f5;color:#1e3a8a}button.outline[_ngcontent-%COMP%]:hover{background:#eef2ff}button.danger[_ngcontent-%COMP%]{background:#ef4444;border:none;color:#fff}button.danger[_ngcontent-%COMP%]:hover{background:#dc2626}.new-card-btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px}']})};export{re as Cards};
