import{b as N,d as S,h as E}from"./chunk-4CNLZDSJ.js";import{a as z}from"./chunk-WZIJEAUU.js";import{b as I,c as m,d as w,e as M,f as O,g as p,h as D,i as R,j as k,k as A,l as T,m as P,n as j,o as $,p as G,t as q}from"./chunk-KIDSA5FJ.js";import{d as V}from"./chunk-B76GRXA5.js";import{$a as d,Ab as y,Bb as v,Ia as s,Na as b,Ra as h,ab as o,bb as r,cb as g,gc as C,mb as f,mc as _,tc as F,za as a,zb as l}from"./chunk-WY347VJD.js";import"./chunk-7CGTOI24.js";function L(c,e){if(c&1&&(o(0,"option",11),l(1),r()),c&2){let t=e.$implicit;d("ngValue",t.id),a(),v(" ",t.name," ")}}var H=class c{constructor(e,t,i,n,u){this.http=e;this.router=t;this.route=i;this.categoriesService=n;this.toastr=u}isEdit=!1;commitmentId;categories=[];api="https://controlefinanceiro-pgsn.onrender.com/api/fixed-commitments/";form=new O({name:new p("",{nonNullable:!0,validators:[m.required]}),value:new p("",{nonNullable:!0,validators:[m.required]}),category:new p(null,{validators:[m.required]}),due_day:new p(null,{validators:[m.required,m.min(1),m.max(31)]})});ngOnInit(){this.categoriesService.getCategories().subscribe(t=>{this.categories=t,this.form.controls.category.setValue(null)});let e=this.route.snapshot.paramMap.get("id");e&&(this.isEdit=!0,this.commitmentId=Number(e),this.loadCommitment())}loadCommitment(){this.http.get(`${this.api}${this.commitmentId}/`).subscribe({next:e=>{this.form.patchValue({name:e.name,value:new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e.value),category:e.category,due_day:e.due_day})},error:()=>{this.toastr.error("Erro ao carregar compromisso"),this.router.navigate(["/fixed-commitments"])}})}create(e){this.http.post(this.api,e).subscribe({next:()=>{this.toastr.success("Compromisso fixo cadastrado"),this.router.navigate(["/fixed-commitments"])},error:()=>{this.toastr.error("Erro ao cadastrar compromisso")}})}update(e){this.http.put(`${this.api}${this.commitmentId}/`,e).subscribe({next:()=>{this.toastr.success("Compromisso atualizado"),this.router.navigate(["/fixed-commitments"])},error:()=>{this.toastr.error("Erro ao atualizar compromisso")}})}formatValue(){let e=this.form.controls.value,t=e.value;if(!t)return;let i=t.replace(/\D/g,"");if(!i){e.setValue("",{emitEvent:!1});return}let n=Number(i)/100,u=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(n);e.setValue(u,{emitEvent:!1})}save(){if(this.form.invalid){this.form.markAllAsTouched(),this.toastr.warning("Preencha todos os campos");return}let e=this.form.controls.name.value.trim(),t=Number(this.form.controls.value.value.replace(/\./g,"").replace(",",".")),i=Number(this.form.controls.category.value),n=Number(this.form.controls.due_day.value),u={name:e,value:t,category:i,due_day:n};if(!this.isEdit){this.http.get(this.api).subscribe(B=>{if(B.some(x=>x.name.toLowerCase().trim()===e.toLowerCase()&&x.active===!0)){this.toastr.warning("J\xE1 existe um compromisso ativo com esse nome. Edite o existente.");return}this.create(u)});return}this.update(u)}cancel(){this.router.navigate(["/fixed-commitments"])}static \u0275fac=function(t){return new(t||c)(s(F),s(S),s(N),s(z),s(V))};static \u0275cmp=b({type:c,selectors:[["app-fixed-commitment-form"]],decls:16,vars:5,consts:[[1,"form-overlay"],[3,"ngSubmit","formGroup"],["placeholder","Nome (ex: \xC1gua)","formControlName","name"],["type","text","placeholder","Valor (R$)","formControlName","value","inputmode","decimal",3,"blur"],["formControlName","category"],["disabled","",3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["type","number","placeholder","Dia do vencimento (1\u201331)","formControlName","due_day","min","1","max","31"],[1,"actions"],["type","submit",1,"primary"],["type","button",1,"secondary",3,"click"],[3,"ngValue"]],template:function(t,i){t&1&&(o(0,"div",0)(1,"form",1),f("ngSubmit",function(){return i.save()}),o(2,"h2"),l(3),r(),g(4,"input",2),o(5,"input",3),f("blur",function(){return i.formatValue()}),r(),o(6,"select",4)(7,"option",5),l(8," Selecione a categoria "),r(),h(9,L,2,2,"option",6),r(),g(10,"input",7),o(11,"div",8)(12,"button",9),l(13),r(),o(14,"button",10),f("click",function(){return i.cancel()}),l(15,"Cancelar"),r()()()()),t&2&&(a(),d("formGroup",i.form),a(2),y(i.isEdit?"Editar compromisso fixo":"Novo compromisso fixo"),a(4),d("ngValue",null),a(2),d("ngForOf",i.categories),a(4),v(" ",i.isEdit?"Atualizar":"Salvar"," "))},dependencies:[_,C,q,D,P,j,I,R,T,w,M,G,$,A,k,E],styles:["form[_ngcontent-%COMP%]{background:#fff;padding:24px;border-radius:16px;width:100%;max-width:420px;display:flex;flex-direction:column;gap:16px;box-shadow:0 10px 30px #0000001f}input[_ngcontent-%COMP%]{background:#f1f5f9;border:1px solid #cbd5f5;border-radius:10px;padding:12px;color:#0f172a}.actions[_ngcontent-%COMP%]{display:flex;gap:12px}button.primary[_ngcontent-%COMP%]{background:#2563eb;color:#fff;border:none;padding:12px;border-radius:12px;font-weight:600}button.secondary[_ngcontent-%COMP%]{background:transparent;border:1px solid #cbd5f5;color:#2563eb;padding:12px;border-radius:12px}.form-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0f172a73;display:flex;align-items:center;justify-content:center;z-index:50}"]})};export{H as FixedCommitmentForm};
