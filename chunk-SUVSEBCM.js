import{b as w,c as v,d as F,e as R,f as D,g as b,h as T,j as V,k,l as q,m as B,n as L,t as G}from"./chunk-KIDSA5FJ.js";import{d as N}from"./chunk-B76GRXA5.js";import{$a as m,Ab as P,Bb as g,Ia as d,Na as S,Q as c,R as u,Ra as x,Vb as O,ab as n,bb as i,hc as y,kb as E,mb as f,mc as I,ob as p,tc as M,v as _,za as s,zb as r}from"./chunk-WY347VJD.js";import{a as h,b as C}from"./chunk-7CGTOI24.js";function j(l,t){l&1&&(n(0,"div",3),r(1,"Carregando..."),i())}function H(l,t){if(l&1&&(n(0,"div",17),r(1),i()),l&2){let e=p(2);s(),P(e.message)}}function J(l,t){if(l&1){let e=E();n(0,"form",4),f("ngSubmit",function(){c(e);let o=p();return u(o.save())}),n(1,"label")(2,"div",5),r(3,"Sal\xE1rio bruto"),i(),n(4,"input",6),f("blur",function(){c(e);let o=p();return u(o.formatSalario())}),i()(),n(5,"label")(6,"div",5),r(7,"Tipo de v\xEDnculo"),i(),n(8,"select",7)(9,"option",8),r(10,"Selecione"),i(),n(11,"option",9),r(12,"CLT"),i(),n(13,"option",10),r(14,"PJ"),i(),n(15,"option",11),r(16,"Aut\xF4nomo"),i()()(),n(17,"div",12)(18,"div")(19,"strong"),r(20,"INSS:"),i(),r(21),i(),n(22,"div")(23,"strong"),r(24,"Sal\xE1rio l\xEDquido:"),i(),r(25),i(),n(26,"div")(27,"strong"),r(28,"Limite mensal sugerido:"),i(),r(29),i(),n(30,"sub"),r(31,"(valores aproximados)"),i()(),n(32,"div",13)(33,"button",14),r(34,"Salvar"),i(),n(35,"button",15),f("click",function(){c(e);let o=p();return u(o.load())}),r(36,"Recarregar"),i()(),x(37,H,2,1,"div",16),i()}if(l&2){let e=p();m("formGroup",e.form),s(21),g(" ",e.formatBRL(e.inss)),s(4),g(" ",e.formatBRL(e.salario_liquido)),s(4),g(" ",e.formatBRL(e.limite_mensal)),s(4),m("disabled",e.saving),s(2),m("disabled",e.saving||e.loading),s(2),m("ngIf",e.message&&!e.loading)}}var A=class l{constructor(t,e,a){this.http=t;this.cd=e;this.toastr=a;this.form=new D({salario_bruto:new b(null,{validators:[v.required]}),tipo_vinculo:new b(null,{validators:[v.required]})})}form;message="";loading=!0;saving=!1;inss=null;salario_liquido=null;limite_mensal=null;api="http://localhost:8000/api/profile/";ngOnInit(){this.load()}load(){this.loading=!0,this.inss=null,this.salario_liquido=null,this.limite_mensal=null,this.cd.detectChanges(),this.http.get(this.api).pipe(_(1)).subscribe({next:t=>{this.form.reset({salario_bruto:t.salario_bruto!=null?new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t.salario_bruto):null,tipo_vinculo:t.tipo_vinculo??null},{emitEvent:!1}),this.inss=t.inss??null,this.salario_liquido=t.salario_liquido??null,this.limite_mensal=t.limite_mensal??null,this.loading=!1,this.cd.detectChanges()},error:t=>{console.log("ERRO PROFILE:",t),this.loading=!1,this.toastr.error("Erro ao carregar perfil"),this.cd.detectChanges()}})}save(){if(this.form.invalid){this.form.markAllAsTouched(),this.toastr.warning("Preencha todos os campos obrigat\xF3rios");return}let t=this.form.value.salario_bruto;if(!t)return;let e=Number(t.replace(/\./g,"").replace(",",".")),a=C(h({},this.form.value),{salario_bruto:e});this.saving=!0,this.http.put(this.api,a).pipe(_(1)).subscribe({next:o=>{this.inss=o.inss??null,this.salario_liquido=o.salario_liquido??null,this.limite_mensal=o.limite_mensal??null,this.saving=!1,this.toastr.success("Perfil salvo com sucesso"),this.cd.detectChanges()},error:o=>{console.log("ERRO SAVE:",o),this.saving=!1,this.toastr.error("Erro ao salvar perfil"),this.cd.detectChanges()}})}formatBRL(t){return t==null?"-":new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t)}formatSalario(){let t=this.form.controls.salario_bruto,e=t.value;if(!e)return;let a=e.replace(/\./g,"").replace(",","."),o=Number(a);if(isNaN(o))return;let z=new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(o);t.setValue(z,{emitEvent:!1})}static \u0275fac=function(e){return new(e||l)(d(M),d(O),d(N))};static \u0275cmp=S({type:l,selectors:[["app-profile"]],decls:5,vars:2,consts:[[1,"profile-page","card"],["class","status",4,"ngIf"],["class","profile-form",3,"formGroup","ngSubmit",4,"ngIf"],[1,"status"],[1,"profile-form",3,"ngSubmit","formGroup"],[1,"label"],["formControlName","salario_bruto",3,"blur"],["formControlName","tipo_vinculo"],["value",""],["value","clt"],["value","pj"],["value","autonomo"],[1,"computed"],[1,"actions"],["type","submit",1,"primary",3,"disabled"],["type","button",1,"outline",3,"click","disabled"],["class","message error",4,"ngIf"],[1,"message","error"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"h1"),r(2,"Perfil"),i(),x(3,j,2,0,"div",1)(4,J,38,7,"form",2),i()),e&2&&(s(3),m("ngIf",a.loading),s(),m("ngIf",!a.loading))},dependencies:[I,y,G,T,B,L,w,q,F,R,k,V],styles:[".profile-page[_ngcontent-%COMP%]{max-width:720px;margin:16px auto;padding:20px;background:var(--bg-card);border-radius:12px;box-shadow:0 6px 18px #0206170f}.profile-page[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 16px;font-size:20px}.profile-form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:12px}.profile-form[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:12px;color:var(--text-muted);margin-bottom:6px}.profile-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .profile-form[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:10px 12px;border-radius:8px;border:1px solid #e2e8f0;background:var(--bg-muted)}.computed[_ngcontent-%COMP%]{margin:12px 0;font-size:14px;color:var(--text-main);display:grid;gap:6px}.actions[_ngcontent-%COMP%]{display:flex;gap:12px;margin-top:8px}.primary[_ngcontent-%COMP%]{background:var(--primary);color:#fff;padding:10px 14px;border-radius:10px;border:none;cursor:pointer}.outline[_ngcontent-%COMP%]{background:transparent;border:1px solid #cbd5e1;padding:10px 14px;border-radius:10px;cursor:pointer;color:var(--text-main)}.status[_ngcontent-%COMP%], .message[_ngcontent-%COMP%]{margin-top:12px;color:var(--text-muted);font-size:13px}"]})};export{A as Profile};
