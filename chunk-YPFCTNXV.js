import{d as p}from"./chunk-B76GRXA5.js";import{C as n,G as s,K as i,tc as c}from"./chunk-WY347VJD.js";var l=class r{constructor(t,e){this.http=t;this.toastr=e}api="http://127.0.0.1:8000/api/auth";expirationTimer;login(t){return this.http.post(`${this.api}/login/`,t).pipe(n(e=>{localStorage.setItem("access_token",e.access),localStorage.setItem("refresh_token",e.refresh),localStorage.setItem("auth_user",JSON.stringify({username:t.username})),this.startTokenExpirationWatcher()}))}register(t){return this.http.post(`${this.api}/register/`,{username:t.username,email:t.email,password:t.password})}logout(){localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("auth_user"),this.expirationTimer&&(clearTimeout(this.expirationTimer),this.expirationTimer=null)}isAuthenticated(){return!!localStorage.getItem("access_token")}get token(){return localStorage.getItem("access_token")}getTokenExpiration(){let t=localStorage.getItem("access_token");if(!t)return null;try{let e=JSON.parse(atob(t.split(".")[1]));return e.exp?e.exp*1e3:null}catch{return null}}startTokenExpirationWatcher(){let t=this.getTokenExpiration();if(!t)return;let e=Date.now(),o=t-e,a=120*1e3;if(o<=0){this.logout();return}o>a&&(this.expirationTimer=setTimeout(()=>{this.toastr.warning("Sua sess\xE3o vai expirar em breve.","Aten\xE7\xE3o")},o-a))}static \u0275fac=function(e){return new(e||r)(i(c),i(p))};static \u0275prov=s({token:r,factory:r.\u0275fac,providedIn:"root"})};export{l as a};
